<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube 채널 관리 - YouTube Shorts 도구</title>
    <link rel="icon" href="/static/favicon.ico" type="image/x-icon">
    
    <!-- 부트스트랩 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome 아이콘 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- 커스텀 CSS -->
    <link rel="stylesheet" href="/static/css/styles.css">
    
    <style>
        /* YouTube 관리 시스템 전용 스타일 */
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border: 1px solid #e9ecef;
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-card .icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: #667eea;
        }
        
        .stat-card .value {
            font-size: 2rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .stat-card .label {
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .amount {
            color: #667eea;
            font-weight: 600;
        }
        
        .profit-positive {
            color: #28a745;
            font-weight: 600;
        }
        
        .profit-negative {
            color: #dc3545;
            font-weight: 600;
        }
        
        /* 탭 네비게이션 스타일 개선 */
        .nav-tabs {
            border-bottom: 2px solid #dee2e6;
            margin-bottom: 20px;
        }
        
        .nav-tabs .nav-link {
            border: none;
            border-bottom: 3px solid transparent;
            color: #6c757d;
            font-weight: 500;
            padding: 1rem 1.5rem;
            margin-bottom: -2px;
        }
        
        .nav-tabs .nav-link:hover {
            border-color: transparent;
            background-color: #f8f9fa;
            color: #495057;
        }
        
        .nav-tabs .nav-link.active {
            background-color: transparent;
            border-bottom-color: #667eea;
            color: #667eea;
            font-weight: 600;
        }
        
        /* 모바일 대응 개선 */
        @media (max-width: 767.98px) {
            .stats-cards {
                grid-template-columns: 1fr !important;
                gap: 15px;
            }
            
            .stat-card {
                padding: 20px;
            }
            
            .stat-card .value {
                font-size: 1.5rem;
            }
            
            .stat-card .icon {
                font-size: 2rem;
            }
            
            .nav-tabs {
                flex-wrap: nowrap;
                overflow-x: auto;
                scrollbar-width: none;
                -ms-overflow-style: none;
            }
            
            .nav-tabs::-webkit-scrollbar {
                display: none;
            }
            
            .nav-tabs .nav-link {
                flex-shrink: 0;
                padding: 0.75rem 1rem;
                font-size: 0.9rem;
            }
            
            .table-responsive {
                font-size: 0.85rem;
            }
            
            .modal-dialog {
                margin: 0.5rem;
                max-width: calc(100% - 1rem);
            }
        }
        
        @media (max-width: 576px) {
            .stat-card {
                padding: 15px;
            }
            
            .stat-card .value {
                font-size: 1.3rem;
            }
            
            .nav-tabs .nav-link {
                padding: 0.5rem 0.75rem;
                font-size: 0.8rem;
            }
        }
        
        /* 가로 모드 대응 */
        @media (max-width: 767.98px) and (orientation: landscape) {
            .stats-cards {
                grid-template-columns: repeat(2, 1fr) !important;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">
                <i class="fab fa-youtube text-danger me-2"></i>YouTube Shorts 도구
            </a>
            <!-- 모바일 사이드바 토글 버튼 -->
            <button class="navbar-toggler d-md-none me-2" type="button" onclick="toggleSidebar()" aria-label="Toggle sidebar">
                <i class="fas fa-bars"></i>
            </button>
            <!-- 네비게이션 토글 버튼 -->
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/"><i class="fas fa-home me-1"></i>홈</a>
                    </li>
                    {% if current_user.is_admin() %}
                    <li class="nav-item">
                        <a class="nav-link" href="/admin/users"><i class="fas fa-users me-1"></i>사용자 관리</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/admin/stats"><i class="fas fa-chart-line me-1"></i>통계</a>
                    </li>
                    {% endif %}
                </ul>
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <img src="{{ current_user.picture }}" alt="프로필" class="rounded-circle me-1" style="width: 24px; height: 24px;">
                            {{ current_user.name }}
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
                            <li><a class="dropdown-item" href="/logout"><i class="fas fa-sign-out-alt me-1"></i>로그아웃</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-5 pt-3">
        <div class="row">
            <!-- 사이드바 메뉴 -->
            <div class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse show" id="sidebarMenu">
                <div class="position-sticky pt-3">
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="/">
                                <i class="fas fa-search me-2"></i>인기 Shorts 검색
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/#page-channels">
                                <i class="fas fa-users me-2"></i>채널 관리
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/notifications">
                                <i class="fas fa-bell me-2"></i>이메일 알림 설정
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="/youtube-management">
                                <i class="fas fa-video me-2"></i>YouTube 관리
                            </a>
                        </li>
                        {% if current_user.is_admin() %}
                        <li class="nav-item">
                            <a class="nav-link" href="/admin/users">
                                <i class="fas fa-user-cog me-2"></i>사용자 관리
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/admin/stats">
                                <i class="fas fa-chart-bar me-2"></i>API 사용 통계
                            </a>
                        </li>
                        {% endif %}
                    </ul>
                </div>
            </div>

            <!-- 메인 콘텐츠 영역 -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2"><i class="fas fa-video me-2"></i>YouTube 채널 관리 시스템</h1>
                    <div class="btn-group">
                        <button type="button" class="btn btn-sm btn-outline-secondary" onclick="exportData()">
                            <i class="fas fa-download me-1"></i>데이터 내보내기
                        </button>
                        <label class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-upload me-1"></i>데이터 가져오기
                            <input type="file" accept=".json" onchange="importData(event)" style="display: none;">
                        </label>
                    </div>
                </div>

                <div id="statusMessage"></div>

                <!-- 탭 네비게이션 -->
                <ul class="nav nav-tabs" id="managementTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="dashboard-tab" data-bs-toggle="tab" data-bs-target="#dashboard" type="button" role="tab">
                            <i class="fas fa-chart-pie me-1"></i>대시보드
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="works-tab" data-bs-toggle="tab" data-bs-target="#works" type="button" role="tab">
                            <i class="fas fa-tasks me-1"></i>작업 현황
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="revenue-tab" data-bs-toggle="tab" data-bs-target="#revenue" type="button" role="tab">
                            <i class="fas fa-dollar-sign me-1"></i>매출 관리
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="editors-tab" data-bs-toggle="tab" data-bs-target="#editors" type="button" role="tab">
                            <i class="fas fa-user-edit me-1"></i>편집자 관리
                        </button>
                    </li>
                </ul>

                <!-- 탭 콘텐츠 -->
                <div class="tab-content" id="managementTabContent">
                    <!-- 대시보드 탭 -->
                    <div class="tab-pane fade show active" id="dashboard" role="tabpanel">
                        <div class="py-4">
                            <div class="stats-cards">
                                <div class="stat-card">
                                    <div class="icon"><i class="fas fa-users"></i></div>
                                    <div class="value" id="totalEditors">0</div>
                                    <div class="label">총 편집자 수</div>
                                </div>
                                <div class="stat-card">
                                    <div class="icon"><i class="fas fa-video"></i></div>
                                    <div class="value" id="thisWeekWorks">0</div>
                                    <div class="label">이번 주 작업량</div>
                                </div>
                                <div class="stat-card">
                                    <div class="icon"><i class="fas fa-money-bill-wave"></i></div>
                                    <div class="value" id="thisWeekPay">0원</div>
                                    <div class="label">이번 주 지급액</div>
                                </div>
                                <div class="stat-card">
                                    <div class="icon"><i class="fas fa-chart-line"></i></div>
                                    <div class="value" id="thisMonthRevenue">0원</div>
                                    <div class="label">이번 달 수익</div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header">
                                            <h5 class="mb-0"><i class="fas fa-trophy me-2"></i>편집자 성과 랭킹</h5>
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-sm">
                                                    <thead>
                                                        <tr>
                                                            <th>순위</th>
                                                            <th>편집자</th>
                                                            <th>완료 건수</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="editorRanking">
                                                        <!-- 동적으로 채워집니다 -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-header">
                                            <h5 class="mb-0"><i class="fas fa-calendar-week me-2"></i>주간 작업 현황</h5>
                                        </div>
                                        <div class="card-body">
                                            <div class="table-responsive">
                                                <table class="table table-sm">
                                                    <thead>
                                                        <tr>
                                                            <th>요일</th>
                                                            <th>작업량</th>
                                                            <th>상태</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="weeklyStatus">
                                                        <!-- 동적으로 채워집니다 -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 작업 현황 탭 -->
                    <div class="tab-pane fade" id="works" role="tabpanel">
                        <div class="py-4">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <div>
                                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addWorkModal">
                                        <i class="fas fa-plus me-1"></i>새 작업 추가
                                    </button>
                                    <button class="btn btn-outline-secondary ms-2" onclick="exportWeeklyData()">
                                        <i class="fas fa-file-export me-1"></i>주간 데이터 내보내기
                                    </button>
                                </div>
                                <div class="btn-group" role="group">
                                    <input type="radio" class="btn-check" name="workFilter" id="weekFilter" autocomplete="off" checked onchange="loadWorks('week')">
                                    <label class="btn btn-outline-primary" for="weekFilter">이번 주</label>
                                    
                                    <input type="radio" class="btn-check" name="workFilter" id="monthFilter" autocomplete="off" onchange="loadWorks('month')">
                                    <label class="btn btn-outline-primary" for="monthFilter">이번 달</label>
                                    
                                    <input type="radio" class="btn-check" name="workFilter" id="allFilter" autocomplete="off" onchange="loadWorks('all')">
                                    <label class="btn btn-outline-primary" for="allFilter">전체</label>
                                </div>
                            </div>
                            
                            <div class="row mb-4">
                                <div class="col-md-3">
                                    <div class="stat-card">
                                        <div class="value" id="weeklyTotal">0건</div>
                                        <div class="label">총 작업량</div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stat-card">
                                        <div class="value amount" id="weeklyAmount">0원</div>
                                        <div class="label">총 지급 예정액</div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stat-card">
                                        <div class="value amount" id="weeklyTax">0원</div>
                                        <div class="label">세금 공제액 (3.3%)</div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="stat-card">
                                        <div class="value amount" id="weeklyNet">0원</div>
                                        <div class="label">실 지급액</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 편집자별 지급 예정금액 카드 -->
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h5 class="mb-0"><i class="fas fa-users me-2"></i>편집자별 지급 예정금액</h5>
                                </div>
                                <div class="card-body">
                                    <div id="editorPaymentCards" class="row">
                                        <!-- 동적으로 채워집니다 -->
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card">
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table">
                                            <thead>
                                                <tr>
                                                    <th>날짜</th>
                                                    <th>편집자</th>
                                                    <th>영상 제목</th>
                                                    <th>작업 유형</th>
                                                    <th>단가</th>
                                                    <th>상태</th>
                                                    <th>관리</th>
                                                </tr>
                                            </thead>
                                            <tbody id="worksTable">
                                                <!-- 동적으로 채워집니다 -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 매출 관리 탭 -->
                    <div class="tab-pane fade" id="revenue" role="tabpanel">
                        <div class="py-4">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addRevenueModal">
                                    <i class="fas fa-plus me-1"></i>수익 데이터 추가
                                </button>
                            </div>
                            
                            <div class="stats-cards">
                                <div class="stat-card">
                                    <div class="value amount" id="totalRevenue">0원</div>
                                    <div class="label">총 누적 수익</div>
                                </div>
                                <div class="stat-card">
                                    <div class="value amount" id="totalCosts">0원</div>
                                    <div class="label">총 편집 비용</div>
                                </div>
                                <div class="stat-card">
                                    <div class="value profit-positive" id="totalProfit">0원</div>
                                    <div class="label">순이익</div>
                                </div>
                                <div class="stat-card">
                                    <div class="value" id="profitMargin">0%</div>
                                    <div class="label">수익률</div>
                                </div>
                            </div>
                            
                            <div class="card">
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table">
                                            <thead>
                                                <tr>
                                                    <th>월</th>
                                                    <th>유튜브 수익</th>
                                                    <th>음원 수익</th>
                                                    <th>기타 수익</th>
                                                    <th>총 수익</th>
                                                    <th>편집 비용</th>
                                                    <th>순이익</th>
                                                    <th>관리</th>
                                                </tr>
                                            </thead>
                                            <tbody id="revenueTable">
                                                <!-- 동적으로 채워집니다 -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 편집자 관리 탭 -->
                    <div class="tab-pane fade" id="editors" role="tabpanel">
                        <div class="py-4">
                            <div class="d-flex justify-content-between align-items-center mb-4">
                                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addEditorModal">
                                    <i class="fas fa-plus me-1"></i>새 편집자 추가
                                </button>
                            </div>
                            
                            <div class="card">
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table">
                                            <thead>
                                                <tr>
                                                    <th>편집자명</th>
                                                    <th>연락처</th>
                                                    <th>이메일</th>
                                                    <th>계약일</th>
                                                    <th>기본 단가</th>
                                                    <th>일본어 단가</th>
                                                    <th>상태</th>
                                                    <th>관리</th>
                                                </tr>
                                            </thead>
                                            <tbody id="editorsTable">
                                                <!-- 동적으로 채워집니다 -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- 편집자 추가 모달 -->
    <div class="modal fade" id="addEditorModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-user-plus me-2"></i>새 편집자 추가</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addEditorForm">
                        <div class="mb-3">
                            <label class="form-label">편집자명 *</label>
                            <input type="text" class="form-control" name="name" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">연락처</label>
                            <input type="text" class="form-control" name="contact">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">이메일</label>
                            <input type="email" class="form-control" name="email">
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">기본 단가</label>
                                    <input type="number" class="form-control" name="basic_rate" value="15000">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">일본어 단가</label>
                                    <input type="number" class="form-control" name="japanese_rate" value="20000">
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">특이사항</label>
                            <textarea class="form-control" name="notes" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
                    <button type="button" class="btn btn-primary" onclick="addEditor()">추가</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 편집자 단가 변경 모달 -->
    <div class="modal fade" id="changeRateModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-dollar-sign me-2"></i>편집자 단가 변경</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="changeRateForm">
                        <input type="hidden" name="editor_id" id="changeRateEditorId">
                        <div class="mb-3">
                            <label class="form-label">편집자명</label>
                            <input type="text" class="form-control" id="changeRateEditorName" readonly>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">현재 기본 단가</label>
                                    <input type="text" class="form-control" id="currentBasicRate" readonly>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">새 기본 단가 *</label>
                                    <input type="number" class="form-control" name="new_basic_rate" id="newBasicRate" required>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">현재 일본어 단가</label>
                                    <input type="text" class="form-control" id="currentJapaneseRate" readonly>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">새 일본어 단가 *</label>
                                    <input type="number" class="form-control" name="new_japanese_rate" id="newJapaneseRate" required>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">적용일 *</label>
                            <input type="date" class="form-control" name="effective_date" id="effectiveDate" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">변경 사유 *</label>
                            <textarea class="form-control" name="change_reason" id="changeReason" rows="3" required placeholder="단가 변경 사유를 입력하세요"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
                    <button type="button" class="btn btn-primary" onclick="updateEditorRate()">변경</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 작업 추가 모달 -->
    <div class="modal fade" id="addWorkModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-video me-2"></i>새 작업 추가</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addWorkForm">
                        <div class="mb-3">
                            <label class="form-label">편집자 선택 *</label>
                            <select class="form-select" name="editor_id" id="editorSelect" required>
                                <option value="">편집자를 선택하세요</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">영상 제목 *</label>
                            <input type="text" class="form-control" name="title" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">작업 유형 *</label>
                            <select class="form-select" name="work_type" required>
                                <option value="basic">기본 편집</option>
                                <option value="japanese">일본어 번역 + 편집</option>
                            </select>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">작업일 *</label>
                                    <input type="date" class="form-control" name="work_date" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">마감일</label>
                                    <input type="date" class="form-control" name="deadline">
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">특이사항</label>
                            <textarea class="form-control" name="notes" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
                    <button type="button" class="btn btn-primary" onclick="addWork()">추가</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 작업 수정 모달 -->
    <div class="modal fade" id="editWorkModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-edit me-2"></i>작업 정보 수정</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editWorkForm">
                        <input type="hidden" name="work_id" id="editWorkId">
                        <div class="mb-3">
                            <label class="form-label">편집자 선택 *</label>
                            <select class="form-select" name="editor_id" id="editEditorSelect" required>
                                <option value="">편집자를 선택하세요</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">영상 제목 *</label>
                            <input type="text" class="form-control" name="title" id="editWorkTitle" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">작업 유형 *</label>
                            <select class="form-select" name="work_type" id="editWorkType" required>
                                <option value="basic">기본 편집</option>
                                <option value="japanese">일본어 번역 + 편집</option>
                            </select>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">작업일 *</label>
                                    <input type="date" class="form-control" name="work_date" id="editWorkDate" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">마감일</label>
                                    <input type="date" class="form-control" name="deadline" id="editWorkDeadline">
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">작업 상태</label>
                            <select class="form-select" name="status" id="editWorkStatus">
                                <option value="pending">대기중</option>
                                <option value="in_progress">진행중</option>
                                <option value="completed">완료</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">특이사항</label>
                            <textarea class="form-control" name="notes" id="editWorkNotes" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
                    <button type="button" class="btn btn-primary" onclick="updateWork()">수정</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 수익 추가 모달 -->
    <div class="modal fade" id="addRevenueModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="revenueModalTitle"><i class="fas fa-chart-line me-2"></i>수익 데이터 추가</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addRevenueForm">
                        <div class="mb-3">
                            <label class="form-label">년월 *</label>
                            <input type="month" class="form-control" name="year_month" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">유튜브 수익</label>
                            <input type="number" class="form-control" name="youtube_revenue" value="0">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">음원 수익</label>
                            <input type="number" class="form-control" name="music_revenue" value="0">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">기타 수익</label>
                            <input type="number" class="form-control" name="other_revenue" value="0">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">특이사항</label>
                            <textarea class="form-control" name="notes" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
                    <button type="button" class="btn btn-primary" id="revenueModalButton" onclick="addRevenue()">추가</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 부트스트랩 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // 전역 변수
        let editors = [];
        let works = [];
        let revenues = [];
        let currentWorkFilter = 'week';

        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', function() {
            // 모바일 사이드바 관리
            initMobileSidebar();

            loadAllData();
            
            // 오늘 날짜를 기본값으로 설정
            const today = new Date().toISOString().split('T')[0];
            const workDateInput = document.querySelector('[name="work_date"]');
            if (workDateInput) {
                workDateInput.value = today;
            }
            
            // 이번 달을 기본값으로 설정
            const thisMonth = new Date().toISOString().substring(0, 7);
            const monthInput = document.querySelector('[name="year_month"]');
            if (monthInput) {
                monthInput.value = thisMonth;
            }
            
            // 수익 모달이 닫힐 때 초기화
            document.getElementById('addRevenueModal').addEventListener('hidden.bs.modal', function () {
                resetRevenueModal();
            });
        });

        // 모든 데이터 로드
        function loadAllData() {
            loadEditors();
            loadWorks(currentWorkFilter);
            loadRevenues();
            loadDashboard();
        }

        // 편집자 데이터 로드
        function loadEditors() {
            fetch('/api/youtube/editors')
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        editors = data.editors;
                        updateEditorsTable();
                        updateEditorSelect();
                    }
                })
                .catch(error => {
                    console.error('편집자 로드 실패:', error);
                    showAlert('편집자 데이터 로드에 실패했습니다.', 'danger');
                });
        }

        // 작업 데이터 로드
        function loadWorks(filter = 'week') {
            currentWorkFilter = filter;
            fetch(`/api/youtube/works?date_filter=${filter}`)
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        works = data.works;
                        updateWorksTable();
                        updateWorkStats();
                    }
                })
                .catch(error => {
                    console.error('작업 로드 실패:', error);
                    showAlert('작업 데이터 로드에 실패했습니다.', 'danger');
                });
        }

        // 수익 데이터 로드
        function loadRevenues() {
            fetch('/api/youtube/revenues')
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        revenues = data.revenues;
                        updateRevenueTable();
                        updateRevenueStats();
                    }
                })
                .catch(error => {
                    console.error('수익 로드 실패:', error);
                    showAlert('수익 데이터 로드에 실패했습니다.', 'danger');
                });
        }

        // 대시보드 데이터 로드
        function loadDashboard() {
            fetch('/api/youtube/dashboard')
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        updateDashboard(data.stats);
                    }
                })
                .catch(error => {
                    console.error('대시보드 로드 실패:', error);
                    showAlert('대시보드 데이터 로드에 실패했습니다.', 'danger');
                });
        }

        // 편집자 추가
        function addEditor() {
            const form = document.getElementById('addEditorForm');
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());

            fetch('/api/youtube/editors', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    showAlert('편집자가 추가되었습니다.', 'success');
                    form.reset();
                    const modal = bootstrap.Modal.getInstance(document.getElementById('addEditorModal'));
                    modal.hide();
                    loadEditors();
                } else {
                    showAlert(data.message, 'danger');
                }
            })
            .catch(error => {
                console.error('편집자 추가 실패:', error);
                showAlert('편집자 추가에 실패했습니다.', 'danger');
            });
        }

        // 작업 추가
        function addWork() {
            const form = document.getElementById('addWorkForm');
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());

            fetch('/api/youtube/works', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    showAlert('작업이 추가되었습니다.', 'success');
                    form.reset();
                    const modal = bootstrap.Modal.getInstance(document.getElementById('addWorkModal'));
                    modal.hide();
                    loadWorks(currentWorkFilter);
                    loadDashboard();
                } else {
                    showAlert(data.message, 'danger');
                }
            })
            .catch(error => {
                console.error('작업 추가 실패:', error);
                showAlert('작업 추가에 실패했습니다.', 'danger');
            });
        }

        // 수익 추가
        function addRevenue() {
            const form = document.getElementById('addRevenueForm');
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());
            
            // 수익 데이터를 정수로 명시적 변환 (문자열 전송 방지)
            data.youtube_revenue = parseInt(data.youtube_revenue) || 0;
            data.music_revenue = parseInt(data.music_revenue) || 0;
            data.other_revenue = parseInt(data.other_revenue) || 0;

            fetch('/api/youtube/revenues', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    showAlert('수익 데이터가 추가되었습니다.', 'success');
                    form.reset();
                    const modal = bootstrap.Modal.getInstance(document.getElementById('addRevenueModal'));
                    modal.hide();
                    loadRevenues();
                    loadDashboard();
                } else {
                    showAlert(data.message, 'danger');
                }
            })
            .catch(error => {
                console.error('수익 추가 실패:', error);
                showAlert('수익 추가에 실패했습니다.', 'danger');
            });
        }

        // 테이블 업데이트 함수들
        function updateEditorsTable() {
            const tbody = document.getElementById('editorsTable');
            tbody.innerHTML = '';

            editors.forEach(editor => {
                const statusBadge = getStatusBadge(editor.status);
                const row = `
                    <tr>
                        <td><strong>${editor.name}</strong></td>
                        <td>${editor.contact || '-'}</td>
                        <td>${editor.email || '-'}</td>
                        <td>${editor.contract_date || '-'}</td>
                        <td class="amount">${editor.basic_rate.toLocaleString()}원</td>
                        <td class="amount">${editor.japanese_rate.toLocaleString()}원</td>
                        <td>${statusBadge}</td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-primary" onclick="changeEditorRate(${editor.id})" title="단가 변경">
                                    <i class="fas fa-dollar-sign"></i>
                                </button>
                                <button class="btn btn-outline-danger" onclick="deleteEditor(${editor.id})" title="삭제">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        function updateWorksTable() {
            const tbody = document.getElementById('worksTable');
            tbody.innerHTML = '';

            works.forEach(work => {
                const statusBadge = getStatusBadge(work.status);
                const workTypeText = work.work_type === 'japanese' ? '일본어 번역+편집' : '기본 편집';
                
                const row = `
                    <tr>
                        <td>${work.work_date}</td>
                        <td><strong>${work.editor_name}</strong></td>
                        <td>${work.title}</td>
                        <td>${workTypeText}</td>
                        <td class="amount">${work.rate.toLocaleString()}원</td>
                        <td>${statusBadge}</td>
                        <td>
                            <div class="btn-group btn-group-sm">
                                <button class="btn btn-outline-primary" onclick="editWork(${work.id})" title="수정">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-outline-success" onclick="updateWorkStatus(${work.id}, 'completed')" title="완료">
                                    <i class="fas fa-check"></i>
                                </button>
                                <button class="btn btn-outline-danger" onclick="deleteWork(${work.id})" title="삭제">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
            
            // 편집자별 지급 예정금액 업데이트
            updateEditorPaymentCards();
        }
        
        // 편집자별 지급 예정금액 카드 업데이트
        function updateEditorPaymentCards() {
            const container = document.getElementById('editorPaymentCards');
            container.innerHTML = '';
            
            // 작업 데이터가 없으면 메시지 표시
            if (!works || works.length === 0) {
                container.innerHTML = '<div class="col-12"><p class="text-muted text-center">작업 데이터가 없습니다.</p></div>';
                return;
            }
            
            // 편집자별 지급 예정금액 계산
            const editorPayments = {};
            works.forEach(work => {
                if (work.status === 'completed' || work.status === 'in_progress') {
                    const editorId = work.editor_id;
                    if (!editorPayments[editorId]) {
                        editorPayments[editorId] = {
                            editor_name: work.editor_name,
                            total_amount: 0,
                            work_count: 0,
                            works: []
                        };
                    }
                    editorPayments[editorId].total_amount += work.rate;
                    editorPayments[editorId].work_count += 1;
                    editorPayments[editorId].works.push(work);
                }
            });
            
            // 편집자별 카드 생성
            Object.values(editorPayments).forEach(payment => {
                const taxAmount = Math.floor(payment.total_amount * 0.033); // 3.3% 세금
                const netAmount = payment.total_amount - taxAmount;
                
                const card = `
                    <div class="col-md-4 col-lg-3 mb-3">
                        <div class="stat-card">
                            <div class="d-flex justify-content-between align-items-center mb-2">
                                <h6 class="mb-0"><strong>${payment.editor_name}</strong></h6>
                                <span class="badge bg-primary">${payment.work_count}건</span>
                            </div>
                            <div>
                                <div class="small text-muted">총 지급예정액</div>
                                <div class="h5 mb-1">${payment.total_amount.toLocaleString()}원</div>
                                <div class="small text-danger">세금공제: -${taxAmount.toLocaleString()}원</div>
                                <div class="small"><strong>실 지급액: ${netAmount.toLocaleString()}원</strong></div>
                            </div>
                        </div>
                    </div>
                `;
                container.innerHTML += card;
            });
            
            // 편집자가 없으면 메시지 표시
            if (Object.keys(editorPayments).length === 0) {
                container.innerHTML = '<div class="col-12"><p class="text-muted text-center">지급 예정인 작업이 없습니다.</p></div>';
            }
        }

        function updateRevenueTable() {
            const tbody = document.getElementById('revenueTable');
            tbody.innerHTML = '';

            revenues.forEach(revenue => {
                // 해당 월의 편집 비용 계산
                const monthWorks = works.filter(w => w.work_date.startsWith(revenue.year_month));
                const monthlyCosts = monthWorks.reduce((sum, w) => sum + w.rate, 0);
                const profit = revenue.total_revenue - monthlyCosts;
                const profitClass = profit >= 0 ? 'profit-positive' : 'profit-negative';
                
                const row = `
                    <tr>
                        <td><strong>${revenue.year_month}</strong></td>
                        <td class="amount">${parseInt(revenue.youtube_revenue || 0).toLocaleString()}원</td>
                        <td class="amount">${parseInt(revenue.music_revenue || 0).toLocaleString()}원</td>
                        <td class="amount">${parseInt(revenue.other_revenue || 0).toLocaleString()}원</td>
                        <td class="amount"><strong>${parseInt(revenue.total_revenue || 0).toLocaleString()}원</strong></td>
                        <td class="amount">${parseInt(monthlyCosts || 0).toLocaleString()}원</td>
                        <td class="${profitClass}"><strong>${(profit || 0).toLocaleString()}원</strong></td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary me-1" onclick="editRevenue(${revenue.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteRevenue(${revenue.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        function updateEditorSelect() {
            const select = document.getElementById('editorSelect');
            select.innerHTML = '<option value="">편집자를 선택하세요</option>';
            
            editors.forEach(editor => {
                if (editor.status === 'active') {
                    select.innerHTML += `<option value="${editor.id}">${editor.name}</option>`;
                }
            });
        }

        // 대시보드 업데이트
        function updateDashboard(stats) {
            document.getElementById('totalEditors').textContent = stats.total_editors;
            document.getElementById('thisWeekWorks').textContent = stats.week_work_count;
            document.getElementById('thisWeekPay').textContent = parseInt(stats.week_payment || 0).toLocaleString() + '원';
            document.getElementById('thisMonthRevenue').textContent = parseInt(stats.month_revenue || 0).toLocaleString() + '원';

            // 편집자 랭킹 업데이트
            const rankingTbody = document.getElementById('editorRanking');
            rankingTbody.innerHTML = '';
            
            stats.editor_rankings.forEach((editor, index) => {
                const row = `
                    <tr>
                        <td>${index + 1}</td>
                        <td><strong>${editor.name}</strong></td>
                        <td>${editor.work_count}건</td>
                    </tr>
                `;
                rankingTbody.innerHTML += row;
            });

            // 주간 상태 업데이트
            const weeklyTbody = document.getElementById('weeklyStatus');
            weeklyTbody.innerHTML = '';
            
            Object.entries(stats.daily_stats).forEach(([day, data]) => {
                const statusBadge = data.status === 'completed' ? 
                    '<span class="badge bg-success">완료</span>' : 
                    '<span class="badge bg-warning">대기</span>';
                    
                const row = `
                    <tr>
                        <td>${day}</td>
                        <td>${data.count}건</td>
                        <td>${statusBadge}</td>
                    </tr>
                `;
                weeklyTbody.innerHTML += row;
            });
        }

        // 작업 통계 업데이트
        function updateWorkStats() {
            const total = works.length;
            const totalAmount = works.reduce((sum, work) => sum + work.rate, 0);
            const tax = Math.floor(totalAmount * 0.033);
            const net = totalAmount - tax;
            
            document.getElementById('weeklyTotal').textContent = total + '건';
            document.getElementById('weeklyAmount').textContent = parseInt(totalAmount || 0).toLocaleString() + '원';
            document.getElementById('weeklyTax').textContent = parseInt(tax || 0).toLocaleString() + '원';
            document.getElementById('weeklyNet').textContent = parseInt(net || 0).toLocaleString() + '원';
        }

        // 수익 통계 업데이트
        function updateRevenueStats() {
            const totalRev = revenues.reduce((sum, r) => sum + r.total_revenue, 0);
            const totalCost = works.reduce((sum, w) => sum + w.rate, 0);
            const profit = totalRev - totalCost;
            const margin = totalRev > 0 ? ((profit / totalRev) * 100).toFixed(1) : 0;
            
            document.getElementById('totalRevenue').textContent = parseInt(totalRev || 0).toLocaleString() + '원';
            document.getElementById('totalCosts').textContent = parseInt(totalCost || 0).toLocaleString() + '원';
            document.getElementById('totalProfit').textContent = (profit || 0).toLocaleString() + '원';
            document.getElementById('profitMargin').textContent = margin + '%';
            
            const profitElement = document.getElementById('totalProfit');
            profitElement.className = profit >= 0 ? 'value profit-positive' : 'value profit-negative';
        }

        // 상태 배지 생성
        function getStatusBadge(status) {
            const badges = {
                'active': '<span class="badge bg-success">활성</span>',
                'inactive': '<span class="badge bg-secondary">비활성</span>',
                'pending': '<span class="badge bg-warning">대기</span>',
                'in_progress': '<span class="badge bg-info">진행중</span>',
                'completed': '<span class="badge bg-success">완료</span>',
                'cancelled': '<span class="badge bg-danger">취소</span>'
            };
            return badges[status] || '<span class="badge bg-secondary">알 수 없음</span>';
        }

        // 작업 상태 업데이트
        function updateWorkStatus(workId, status) {
            fetch(`/api/youtube/works/${workId}/status`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ status: status })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    showAlert('작업 상태가 변경되었습니다.', 'success');
                    loadWorks(currentWorkFilter);
                    loadDashboard();
                } else {
                    showAlert(data.message, 'danger');
                }
            })
            .catch(error => {
                console.error('상태 업데이트 실패:', error);
                showAlert('상태 업데이트에 실패했습니다.', 'danger');
            });
        }

        // 삭제 함수들
        function deleteEditor(editorId) {
            if (!confirm('정말 삭제하시겠습니까?')) return;
            
            fetch(`/api/youtube/editors/${editorId}`, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    showAlert('편집자가 삭제되었습니다.', 'success');
                    loadEditors();
                } else {
                    showAlert(data.message, 'danger');
                }
            })
            .catch(error => {
                console.error('편집자 삭제 실패:', error);
                showAlert('편집자 삭제에 실패했습니다.', 'danger');
            });
        }

        function deleteWork(workId) {
            if (!confirm('정말 삭제하시겠습니까?')) return;
            
            fetch(`/api/youtube/works/${workId}`, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    showAlert('작업이 삭제되었습니다.', 'success');
                    loadWorks(currentWorkFilter);
                    loadDashboard();
                } else {
                    showAlert(data.message, 'danger');
                }
            })
            .catch(error => {
                console.error('작업 삭제 실패:', error);
                showAlert('작업 삭제에 실패했습니다.', 'danger');
            });
        }

        // 편집자 단가 변경 함수
        function changeEditorRate(editorId) {
            const editor = editors.find(e => e.id === editorId);
            if (!editor) {
                showAlert('편집자 정보를 찾을 수 없습니다.', 'danger');
                return;
            }
            
            // 모달 폼에 현재 데이터 채우기
            document.getElementById('changeRateEditorId').value = editor.id;
            document.getElementById('changeRateEditorName').value = editor.name;
            document.getElementById('currentBasicRate').value = editor.basic_rate.toLocaleString() + '원';
            document.getElementById('currentJapaneseRate').value = editor.japanese_rate.toLocaleString() + '원';
            document.getElementById('newBasicRate').value = editor.basic_rate;
            document.getElementById('newJapaneseRate').value = editor.japanese_rate;
            
            // 오늘 날짜를 기본값으로 설정
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('effectiveDate').value = today;
            
            // 변경 사유 초기화
            document.getElementById('changeReason').value = '';
            
            // 모달 표시
            const modal = new bootstrap.Modal(document.getElementById('changeRateModal'));
            modal.show();
        }
        
        function updateEditorRate() {
            const form = document.getElementById('changeRateForm');
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());
            const editorId = data.editor_id;
            
            // 데이터 정리
            const updateData = {
                basic_rate: parseInt(data.new_basic_rate),
                japanese_rate: parseInt(data.new_japanese_rate),
                effective_date: data.effective_date,
                change_reason: data.change_reason
            };
            
            fetch(`/api/youtube/editors/${editorId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(updateData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    showAlert('편집자 단가가 변경되었습니다.', 'success');
                    const modal = bootstrap.Modal.getInstance(document.getElementById('changeRateModal'));
                    modal.hide();
                    loadEditors();
                } else {
                    showAlert(data.message, 'danger');
                }
            })
            .catch(error => {
                console.error('단가 변경 실패:', error);
                showAlert('단가 변경에 실패했습니다.', 'danger');
            });
        }

        // 작업 수정 함수
        function editWork(workId) {
            const work = works.find(w => w.id === workId);
            if (!work) {
                showAlert('작업 정보를 찾을 수 없습니다.', 'danger');
                return;
            }
            
            // 모달 폼에 데이터 채우기
            document.getElementById('editWorkId').value = work.id;
            document.getElementById('editWorkTitle').value = work.title;
            document.getElementById('editWorkType').value = work.work_type;
            document.getElementById('editWorkDate').value = work.work_date;
            document.getElementById('editWorkDeadline').value = work.deadline || '';
            document.getElementById('editWorkStatus').value = work.status;
            document.getElementById('editWorkNotes').value = work.notes || '';
            
            // 편집자 선택
            const editEditorSelect = document.getElementById('editEditorSelect');
            editEditorSelect.innerHTML = '<option value="">편집자를 선택하세요</option>';
            editors.forEach(editor => {
                const option = document.createElement('option');
                option.value = editor.id;
                option.textContent = editor.name;
                if (editor.id === work.editor_id) {
                    option.selected = true;
                }
                editEditorSelect.appendChild(option);
            });
            
            // 모달 표시
            const modal = new bootstrap.Modal(document.getElementById('editWorkModal'));
            modal.show();
        }
        
        function updateWork() {
            const form = document.getElementById('editWorkForm');
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());
            const workId = data.work_id;
            
            fetch(`/api/youtube/works/${workId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    showAlert('작업이 수정되었습니다.', 'success');
                    const modal = bootstrap.Modal.getInstance(document.getElementById('editWorkModal'));
                    modal.hide();
                    loadWorks(currentWorkFilter);
                    loadDashboard();
                } else {
                    showAlert(data.message, 'danger');
                }
            })
            .catch(error => {
                console.error('작업 수정 실패:', error);
                showAlert('작업 수정에 실패했습니다.', 'danger');
            });
        }

        let editingRevenueId = null;

        function editRevenue(revenueId) {
            const revenue = revenues.find(r => r.id === revenueId);
            if (!revenue) return;
            
            editingRevenueId = revenueId;
            
            // 모달 제목과 버튼 텍스트 변경
            document.getElementById('revenueModalTitle').innerHTML = '<i class="fas fa-edit me-2"></i>수익 데이터 수정';
            document.getElementById('revenueModalButton').textContent = '수정';
            document.getElementById('revenueModalButton').setAttribute('onclick', 'updateRevenue()');
            
            // 폼에 기존 데이터 채우기
            const form = document.getElementById('addRevenueForm');
            form.querySelector('input[name="year_month"]').value = revenue.year_month;
            form.querySelector('input[name="youtube_revenue"]').value = revenue.youtube_revenue || 0;
            form.querySelector('input[name="music_revenue"]').value = revenue.music_revenue || 0;
            form.querySelector('input[name="other_revenue"]').value = revenue.other_revenue || 0;
            form.querySelector('textarea[name="notes"]').value = revenue.notes || '';
            
            // 모달 열기
            new bootstrap.Modal(document.getElementById('addRevenueModal')).show();
        }

        function updateRevenue() {
            const form = document.getElementById('addRevenueForm');
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());
            
            // 수익 데이터를 정수로 명시적 변환
            data.youtube_revenue = parseInt(data.youtube_revenue) || 0;
            data.music_revenue = parseInt(data.music_revenue) || 0;
            data.other_revenue = parseInt(data.other_revenue) || 0;

            fetch(`/api/youtube/revenues/${editingRevenueId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    showAlert('수익 데이터가 수정되었습니다.', 'success');
                    bootstrap.Modal.getInstance(document.getElementById('addRevenueModal')).hide();
                    resetRevenueModal();
                    loadRevenues();
                    loadDashboard();
                } else {
                    showAlert(data.message, 'danger');
                }
            })
            .catch(error => {
                console.error('수익 수정 실패:', error);
                showAlert('수익 수정에 실패했습니다.', 'danger');
            });
        }

        function resetRevenueModal() {
            editingRevenueId = null;
            
            // 모달 제목과 버튼을 기본값으로 되돌리기
            document.getElementById('revenueModalTitle').innerHTML = '<i class="fas fa-chart-line me-2"></i>수익 데이터 추가';
            document.getElementById('revenueModalButton').textContent = '추가';
            document.getElementById('revenueModalButton').setAttribute('onclick', 'addRevenue()');
            
            // 폼 초기화
            document.getElementById('addRevenueForm').reset();
            document.querySelector('input[name="youtube_revenue"]').value = '0';
            document.querySelector('input[name="music_revenue"]').value = '0';
            document.querySelector('input[name="other_revenue"]').value = '0';
        }

        function deleteRevenue(revenueId) {
            if (!confirm('정말 삭제하시겠습니까?')) return;
            
            fetch(`/api/youtube/revenues/${revenueId}`, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    showAlert('수익 데이터가 삭제되었습니다.', 'success');
                    loadRevenues();
                    loadDashboard();
                } else {
                    showAlert(data.message, 'danger');
                }
            })
            .catch(error => {
                console.error('수익 삭제 실패:', error);
                showAlert('수익 삭제에 실패했습니다.', 'danger');
            });
        }

        // 데이터 내보내기/가져오기
        function exportData() {
            fetch('/api/youtube/export')
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        const jsonString = JSON.stringify(data.data, null, 2);
                        const blob = new Blob([jsonString], { type: 'application/json' });
                        const url = URL.createObjectURL(blob);
                        
                        const link = document.createElement('a');
                        const timestamp = new Date().toISOString().split('T')[0];
                        link.href = url;
                        link.download = `YouTube관리_${timestamp}.json`;
                        link.click();
                        
                        URL.revokeObjectURL(url);
                        showAlert('데이터가 내보내기되었습니다.', 'success');
                    } else {
                        showAlert(data.message, 'danger');
                    }
                })
                .catch(error => {
                    console.error('데이터 내보내기 실패:', error);
                    showAlert('데이터 내보내기에 실패했습니다.', 'danger');
                });
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    if (confirm('기존 데이터와 병합하시겠습니까?')) {
                        fetch('/api/youtube/import', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(importedData)
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data.status === 'success') {
                                showAlert('데이터가 성공적으로 가져오기되었습니다.', 'success');
                                loadAllData();
                            } else {
                                showAlert(data.message, 'danger');
                            }
                        })
                        .catch(error => {
                            console.error('데이터 가져오기 실패:', error);
                            showAlert('데이터 가져오기에 실패했습니다.', 'danger');
                        });
                    }
                } catch (error) {
                    showAlert('파일 형식이 올바르지 않습니다.', 'danger');
                }
            };
            reader.readAsText(file);
        }

        function exportWeeklyData() {
            const weekWorks = works.filter(work => {
                // 이번 주 작업만 필터링
                const today = new Date();
                const weekStart = new Date(today.setDate(today.getDate() - today.getDay()));
                const workDate = new Date(work.work_date);
                return workDate >= weekStart;
            });
            
            const csvContent = "편집자,작업일,영상제목,작업유형,단가,상태\n" +
                weekWorks.map(work => 
                    `${work.editor_name},${work.work_date},${work.title},${work.work_type === 'japanese' ? '일본어편집' : '기본편집'},${work.rate},${work.status}`
                ).join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', '주간_작업_현황.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        // 알림 표시
        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            const statusMessage = document.getElementById('statusMessage');
            statusMessage.innerHTML = '';
            statusMessage.appendChild(alertDiv);
            
            // 자동 제거
            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }
        // 모바일 사이드바 초기화 함수
        function initMobileSidebar() {
            const sidebarMenu = document.getElementById('sidebarMenu');
            
            // 오버레이 요소 생성
            let sidebarOverlay = document.querySelector('.sidebar-overlay');
            if (!sidebarOverlay) {
                sidebarOverlay = document.createElement('div');
                sidebarOverlay.className = 'sidebar-overlay';
                document.body.appendChild(sidebarOverlay);
                
                // 오버레이 클릭 시 사이드바 닫기
                sidebarOverlay.addEventListener('click', function() {
                    closeSidebar();
                });
            }
            
            // ESC 키로 사이드바 닫기
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && sidebarMenu && sidebarMenu.classList.contains('show')) {
                    closeSidebar();
                }
            });
            
            // 메뉴 링크 클릭 시 모바일에서 사이드바 닫기
            const navLinks = document.querySelectorAll('.sidebar .nav-link');
            navLinks.forEach(link => {
                link.addEventListener('click', function() {
                    if (window.innerWidth < 768) {
                        setTimeout(closeSidebar, 200);
                    }
                });
            });
            
            // 창 크기 변경 시 처리
            let resizeTimeout;
            window.addEventListener('resize', function() {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(function() {
                    if (window.innerWidth >= 768) {
                        // 데스크톱에서는 사이드바 항상 표시, 오버레이 제거
                        if (sidebarMenu) {
                            sidebarMenu.classList.remove('show');
                        }
                        if (sidebarOverlay) {
                            sidebarOverlay.classList.remove('show');
                        }
                        document.body.classList.remove('sidebar-open');
                        
                        // 토글 버튼 아이콘 초기화
                        const toggleButton = document.querySelector('.navbar-toggler i');
                        if (toggleButton) {
                            toggleButton.className = 'fas fa-bars';
                        }
                    }
                }, 250);
            });
            
            // 터치 스와이프 지원
            let touchStartX = null;
            let touchStartY = null;
            let touchStartTime = null;
            
            document.addEventListener('touchstart', function(e) {
                touchStartX = e.touches[0].clientX;
                touchStartY = e.touches[0].clientY;
                touchStartTime = Date.now();
            }, { passive: true });
            
            document.addEventListener('touchend', function(e) {
                if (touchStartX === null || touchStartY === null || touchStartTime === null) {
                    return;
                }
                
                const touchEndX = e.changedTouches[0].clientX;
                const touchEndY = e.changedTouches[0].clientY;
                const touchEndTime = Date.now();
                
                const deltaX = touchEndX - touchStartX;
                const deltaY = touchEndY - touchStartY;
                const deltaTime = touchEndTime - touchStartTime;
                
                if (deltaTime < 300 && Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > 50) {
                    const isOpen = sidebarMenu && sidebarMenu.classList.contains('show');
                    
                    // 왼쪽에서 오른쪽으로 스와이프: 메뉴 열기
                    if (deltaX > 0 && touchStartX < 50 && !isOpen && window.innerWidth < 768) {
                        openSidebar();
                    }
                    // 오른쪽에서 왼쪽으로 스와이프: 메뉴 닫기
                    else if (deltaX < -50 && isOpen && window.innerWidth < 768) {
                        closeSidebar();
                    }
                }
                
                touchStartX = null;
                touchStartY = null;
                touchStartTime = null;
            }, { passive: true });
            
            // 초기 설정
            if (window.innerWidth < 768) {
                closeSidebar();
            }
        }

        // 사이드바 토글 함수
        function toggleSidebar() {
            const sidebarMenu = document.getElementById('sidebarMenu');
            if (!sidebarMenu) return;
            
            const isOpen = sidebarMenu.classList.contains('show');
            
            if (isOpen) {
                closeSidebar();
            } else {
                openSidebar();
            }
        }

        // 사이드바 열기
        function openSidebar() {
            const sidebarMenu = document.getElementById('sidebarMenu');
            const sidebarOverlay = document.querySelector('.sidebar-overlay');
            const toggleButton = document.querySelector('.navbar-toggler i');
            
            if (sidebarMenu && sidebarOverlay) {
                sidebarMenu.classList.add('show');
                sidebarOverlay.classList.add('show');
                document.body.classList.add('sidebar-open');
                
                // 토글 버튼 아이콘 변경
                if (toggleButton) {
                    toggleButton.className = 'fas fa-times';
                }
            }
        }

        // 사이드바 닫기
        function closeSidebar() {
            const sidebarMenu = document.getElementById('sidebarMenu');
            const sidebarOverlay = document.querySelector('.sidebar-overlay');
            const toggleButton = document.querySelector('.navbar-toggler i');
            
            if (sidebarMenu && sidebarOverlay) {
                sidebarMenu.classList.remove('show');
                sidebarOverlay.classList.remove('show');
                document.body.classList.remove('sidebar-open');
                
                // 토글 버튼 아이콘 변경
                if (toggleButton) {
                    toggleButton.className = 'fas fa-bars';
                }
            }
        }
    </script>
</body>
</html>